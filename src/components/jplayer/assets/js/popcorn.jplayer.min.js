// jPlayer Player Plugin for Popcorn JavaScript Library
(function(g){var b="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js",k="http://www.jplayer.org/2.2.0/js/jquery.jplayer.min.js",e="http://www.jplayer.org/2.2.0/js/Jplayer.swf",a="html,flash",i=false,d=false,h=false,j={mp3:{codec:'audio/mpeg; codecs="mp3"',flashCanPlay:true,media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:true,media:"audio"},oga:{codec:'audio/ogg; codecs="vorbis"',flashCanPlay:false,media:"audio"},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:false,media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:false,media:"audio"},fla:{codec:"audio/x-flv",flashCanPlay:true,media:"audio"},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:true,media:"audio"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:true,media:"video"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:false,media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:false,media:"video"},flv:{codec:"video/x-flv",flashCanPlay:true,media:"video"},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:true,media:"video"}},l=function(m){if(m&&typeof m==="object"&&m.hasOwnProperty){return true}else{return false}},f=function(n){var m=false;if(/\.mp3$/i.test(n)){m="mp3"}else{if(/\.mp4$/i.test(n)||/\.m4v$/i.test(n)){m="m4v"}else{if(/\.m4a$/i.test(n)){m="m4a"}else{if(/\.ogg$/i.test(n)||/\.oga$/i.test(n)){m="oga"}else{if(/\.ogv$/i.test(n)){m="ogv"}else{if(/\.webm$/i.test(n)){m="webmv"}}}}}}return m},c=function(m){var o="",n="";if(l(m)){for(var p in m){if(m.hasOwnProperty(p)){o+=n+p;n=","}}}if(i){console.log('getSupplied(): Generated: supplied = "'+o+'"')}return o};g.player("jplayer",{_canPlayType:function(z,m){var t=z.toLowerCase(),C={media:{},options:{}},v=false,B;if(t!=="video"&&t!=="audio"){if(typeof m==="string"){if(/^http.*/i.test(m)){B=f(m);if(B){C.media[B]=m;C.options.solution=a;C.options.supplied=B}}}else{C=m}if(l(C)&&l(C.media)){if(!l(C.options)){C.options={}}if(!C.options.solution){C.options.solution=a}if(!C.options.supplied){C.options.supplied=c(C.media)}var w=C.options.solution.toLowerCase().split(","),y=C.options.supplied.toLowerCase().split(",");for(var x=0;x<w.length;x++){var r=w[x].replace(/^\s+|\s+$/g,""),q=r==="html",p=r==="flash",u;for(var o=0;o<y.length;o++){B=y[o].replace(/^\s+|\s+$/g,"");if(j[B]){if(!u&&q){u=document.createElement(j[B].media)}var s=!!(u&&u.canPlayType&&u.canPlayType(j[B].codec)),A=s&&q,n=j[B].flashCanPlay&&p;if(A||n){v={html:A,type:B};x=w.length;o=y.length}}}}}}return v},_setup:function(){var o=this,n,u,A="unknown",z={},q={},y=false,r=0,s=null,m=false,v=null,x=function(){if(y){if(i){console.log("Dispatched event : durationchange : "+r)}o.dispatchEvent("durationchange")}else{if(i){console.log("DELAYED EVENT (!ready) : durationchange : "+r)}clearTimeout(s);s=setTimeout(x,250)}},w=function(){var D=function(E){if(E.jPlayer.status.duration!==r){r=E.jPlayer.status.duration;x()}},C=function(E){if(!m&&E.jPlayer.status.seekPercent===100){m=true;setTimeout(function(){if(i){console.log("Trigger : canplaythrough")}u._trigger($.jPlayer.event.canplaythrough)},0)}};n.bind($.jPlayer.event.loadstart,function(){setTimeout(function(){if(i){console.log("Trigger : loadeddata")}u._trigger($.jPlayer.event.loadeddata)},0)}).bind($.jPlayer.event.progress,function(E){D(E);C(E)}).bind($.jPlayer.event.timeupdate,function(E){D(E);C(E)}).bind($.jPlayer.event.play,function(){setTimeout(function(){if(i){console.log("Trigger : playing")}u._trigger($.jPlayer.event.playing)},0)});if(i){console.log("Created CUSTOM event handlers for FLASH")}},t=function(){(function(G){n=G("#"+o.id);if(typeof o.src==="string"){A=f(o.src);z[A]=o.src;q.supplied=A;q.solution=a}else{if(l(o.src)){z=l(o.src.media)?o.src.media:{};q=l(o.src.options)?o.src.options:{};q.solution=q.solution||a;q.supplied=q.supplied||c(o.src.media)}}q.swfPath=q.swfPath||e;n.bind(G.jPlayer.event.ready,function(J){if(J.jPlayer.flash.used){w()}G(this).jPlayer("setMedia",z).jPlayer("load")});var D=G.jPlayer.reservedEvent+" loadeddata durationchange",I=D.split(/\s+/g);var H=function(J){n.bind(G.jPlayer.event[J],function(K){if(i){console.log("Dispatched event: "+J+(K&&K.jPlayer?" ("+K.jPlayer.status.currentTime+"s)":""))}o.dispatchEvent(J)});if(i){console.log("Created event handler for: "+J)}};for(var E in G.jPlayer.event){if(G.jPlayer.event.hasOwnProperty(E)){var C=true;for(var F in I){if(I.hasOwnProperty(F)){if(I[F]===E){C=false;break}}}if(C){H(E)}else{if(i){console.log("Skipped auto event handler creation for: "+E)}}}}n.bind(G.jPlayer.event.loadeddata,function(J){if(i){console.log("Dispatched event: loadeddata"+(J&&J.jPlayer?" ("+J.jPlayer.status.currentTime+"s)":""))}o.dispatchEvent("loadeddata");y=true});if(i){console.log("Created CUSTOM event handler for: loadeddata")}n.bind(G.jPlayer.event.durationchange,function(J){r=J.jPlayer.status.duration;x()});if(i){console.log("Created CUSTOM event handler for: durationchange")}n.bind(G.jPlayer.event.error,function(J){v=J.jPlayer.error;if(v.type===G.jPlayer.error.URL){v.code=4}else{v.code=0}if(i){console.log("Dispatched event: error")}if(i){console.dir(v)}o.dispatchEvent("error")});if(i){console.log("Created CUSTOM event handler for: error")}g.player.defineProperty(o,"error",{set:function(){return v},get:function(){return v}});g.player.defineProperty(o,"currentTime",{set:function(J){if(u.status.paused){n.jPlayer("pause",J)}else{n.jPlayer("play",J)}return J},get:function(){return u.status.currentTime}});g.player.defineProperty(o,"duration",{set:function(){if(y){return r}else{return NaN}},get:function(){if(y){return r}else{return NaN}}});g.player.defineProperty(o,"muted",{set:function(J){n.jPlayer("mute",J);return u.options.muted},get:function(){return u.options.muted}});g.player.defineProperty(o,"volume",{set:function(J){n.jPlayer("volume",J);return u.options.volume},get:function(){return u.options.volume}});g.player.defineProperty(o,"paused",{set:function(){return u.status.paused},get:function(){return u.status.paused}});o.play=function(){n.jPlayer("play")};o.pause=function(){n.jPlayer("pause")};n.jPlayer(q);u=n.data("jPlayer")}(jQuery))},p=function(){if(!jQuery.jPlayer){if(!h){h=true;g.getScript(k,function(){h=false;t()})}else{setTimeout(p,250)}}else{t()}},B=function(){if(!window.jQuery){if(!d){d=true;g.getScript(b,function(){d=false;p()})}else{setTimeout(B,250)}}else{p()}};B()},_teardown:function(){jQuery("#"+this.id).jPlayer("destroy")}})}(Popcorn));