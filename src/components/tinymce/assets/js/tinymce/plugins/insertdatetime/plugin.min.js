// plugin.js
tinymce.PluginManager.add("insertdatetime",function(f){var j="Sun Mon Tue Wed Thu Fri Sat Sun".split(" ");var b="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");var g="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");var e="January February March April May June July August September October November December".split(" ");var a=[],d,i;function c(k,m){function l(p,n){p=""+p;if(p.length<n){for(var o=0;o<(n-p.length);o++){p="0"+p}}return p}m=m||new Date();k=k.replace("%D","%m/%d/%Y");k=k.replace("%r","%I:%M:%S %p");k=k.replace("%Y",""+m.getFullYear());k=k.replace("%y",""+m.getYear());k=k.replace("%m",l(m.getMonth()+1,2));k=k.replace("%d",l(m.getDate(),2));k=k.replace("%H",""+l(m.getHours(),2));k=k.replace("%M",""+l(m.getMinutes(),2));k=k.replace("%S",""+l(m.getSeconds(),2));k=k.replace("%I",""+((m.getHours()+11)%12+1));k=k.replace("%p",""+(m.getHours()<12?"AM":"PM"));k=k.replace("%B",""+f.translate(e[m.getMonth()]));k=k.replace("%b",""+f.translate(g[m.getMonth()]));k=k.replace("%A",""+f.translate(b[m.getDay()]));k=k.replace("%a",""+f.translate(j[m.getDay()]));k=k.replace("%%","%");return k}function h(m){var l=c(m);if(f.settings.insertdatetime_element){var k;if(/%[HMSIp]/.test(m)){k=c("%Y-%m-%dT%H:%M")}else{k=c("%Y-%m-%d")}l='<time datetime="'+k+'">'+l+"</time>";var n=f.dom.getParent(f.selection.getStart(),"time");if(n){f.dom.setOuterHTML(n,l);return}}f.insertContent(l)}f.addCommand("mceInsertDate",function(){h(f.getParam("insertdatetime_dateformat",f.translate("%Y-%m-%d")))});f.addCommand("mceInsertTime",function(){h(f.getParam("insertdatetime_timeformat",f.translate("%H:%M:%S")))});f.addButton("insertdatetime",{type:"splitbutton",title:"Insert date/time",onclick:function(){h(d||i)},menu:a});tinymce.each(f.settings.insertdatetime_formats||["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"],function(k){if(!i){i=k}a.push({text:c(k),onclick:function(){d=k;h(k)}})});f.addMenuItem("insertdatetime",{icon:"date",text:"Insert date/time",menu:a,context:"insert"})});