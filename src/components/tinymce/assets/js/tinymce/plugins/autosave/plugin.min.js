// plugin.js
tinymce._beforeUnloadHandler=function(){var a;tinymce.each(tinymce.editors,function(b){if(b.plugins.autosave){b.plugins.autosave.storeDraft()}if(!a&&b.isDirty()&&b.getParam("autosave_ask_before_unload",true)){a=b.translate("You have unsaved changes are you sure you want to navigate away?")}});return a};tinymce.PluginManager.add("autosave",function(j){var d=j.settings,k=tinymce.util.LocalStorage,h,m;h=d.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-";h=h.replace(/\{path\}/g,document.location.pathname);h=h.replace(/\{query\}/g,document.location.search);h=h.replace(/\{id\}/g,j.id);function a(q,o){var p={s:1000,m:60000};q=/^(\d+)([ms]?)$/.exec(""+(q||o));return(q[2]?p[q[2]]:1)*parseInt(q,10)}function c(){var o=parseInt(k.getItem(h+"time"),10)||0;if(new Date().getTime()-o>d.autosave_retention){n(false);return false}return true}function n(o){k.removeItem(h+"draft");k.removeItem(h+"time");if(o!==false){j.fire("RemoveDraft")}}function b(){if(!g()&&j.isDirty()){k.setItem(h+"draft",j.getContent({format:"raw",no_events:true}));k.setItem(h+"time",new Date().getTime());j.fire("StoreDraft")}}function l(){if(c()){j.setContent(k.getItem(h+"draft"),{format:"raw"});j.fire("RestoreDraft")}}function f(){if(!m){setInterval(function(){if(!j.removed){b()}},d.autosave_interval);m=true}}d.autosave_interval=a(d.autosave_interval,"30s");d.autosave_retention=a(d.autosave_retention,"20m");function i(){var o=this;o.disabled(!c());j.on("StoreDraft RestoreDraft RemoveDraft",function(){o.disabled(!c())});f()}function e(){j.undoManager.beforeChange();l();n();j.undoManager.add()}j.addButton("restoredraft",{title:"Restore last draft",onclick:e,onPostRender:i});j.addMenuItem("restoredraft",{text:"Restore last draft",onclick:e,onPostRender:i,context:"file"});function g(p){var o=j.settings.forced_root_block;p=tinymce.trim(typeof p=="undefined"?j.getBody().innerHTML:p);return p===""||new RegExp("^<"+o+"[^>]*>((\u00a0|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+o+">|<br>$","i").test(p)}if(j.settings.autosave_restore_when_empty!==false){j.on("init",function(){if(c()&&g()){l()}});j.on("saveContent",function(){n()})}window.onbeforeunload=tinymce._beforeUnloadHandler;this.hasDraft=c;this.storeDraft=b;this.restoreDraft=l;this.removeDraft=n;this.isEmpty=g});