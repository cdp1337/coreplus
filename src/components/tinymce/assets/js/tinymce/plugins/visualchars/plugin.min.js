// plugin.js
tinymce.PluginManager.add("visualchars",function(c){var a=this,e;function d(l){var g,j,k,n=c.getBody(),o,t=c.selection,f,q;var p,h;p={"\u00a0":"nbsp","\u00ad":"shy"};function r(i){return'<span data-mce-bogus="1" class="mce-'+p[i]+'">'+i+"</span>"}function s(){var u,i="";for(u in p){i+=u}return new RegExp("["+i+"]","g")}function m(){var u,i="";for(u in p){if(i){i+=","}i+="span.mce-"+p[u]}return i}e=!e;a.state=e;c.fire("VisualChars",{state:e});h=s();if(l){q=t.getBookmark()}if(e){j=[];tinymce.walk(n,function(i){if(i.nodeType==3&&i.nodeValue&&h.test(i.nodeValue)){j.push(i)}},"childNodes");for(k=0;k<j.length;k++){o=j[k].nodeValue;o=o.replace(h,r);f=c.dom.create("div",null,o);while((g=f.lastChild)){c.dom.insertAfter(g,j[k])}c.dom.remove(j[k])}}else{j=c.dom.select(m(),n);for(k=j.length-1;k>=0;k--){c.dom.remove(j[k],1)}}t.moveToBookmark(q)}function b(){var f=this;c.on("VisualChars",function(g){f.active(g.state)})}c.addCommand("mceVisualChars",d);c.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:b});c.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:b,selectable:true,context:"view",prependToContext:true});c.on("beforegetcontent",function(f){if(e&&f.format!="raw"&&!f.draft){e=true;d(false)}})});