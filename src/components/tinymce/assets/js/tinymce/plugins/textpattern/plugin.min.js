// plugin.js
tinymce.PluginManager.add("textpattern",function(f){var a=true,b;b=f.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];function j(){if(a){b.sort(function(l,k){if(l.start.length>k.start.length){return -1}if(l.start.length<k.start.length){return 1}return 0});a=false}return b}function d(m){var l=j();for(var k=0;k<l.length;k++){if(m.indexOf(l[k].start)!==0){continue}if(l[k].end&&m.lastIndexOf(l[k].end)!=m.length-l[k].end.length){continue}return l[k]}}function h(o,n,p){var l,m,k;l=j();for(k=0;k<l.length;k++){m=l[k];if(m.end&&o.substr(n-m.end.length-p,m.end.length)==m.end){return m}}}function e(k){var u,n,l,m,o,s,w,p,r,v,t;function q(){m=m.splitText(s);m.splitText(o-s-v);m.deleteData(0,r.start.length);m.deleteData(m.data.length-r.end.length,r.end.length)}u=f.selection;n=f.dom;if(!u.isCollapsed()){return}l=u.getRng(true);m=l.startContainer;o=l.startOffset;w=m.data;v=k?1:0;if(m.nodeType!=3){return}r=h(w,o,v);if(!r){return}s=Math.max(0,o-v);s=w.lastIndexOf(r.start,s-r.end.length-1);if(s===-1){return}p=n.createRng();p.setStart(m,s);p.setEnd(m,o-v);r=d(p.toString());if(!r||!r.end){return}if(m.data.length<=r.start.length+r.end.length){return}t=f.formatter.get(r.format);if(t&&t[0].inline){q();f.formatter.apply(r.format,{},m);return m}}function i(){var u,p,m,s,n,t,r,q,l,k,o;u=f.selection;p=f.dom;if(!u.isCollapsed()){return}r=p.getParent(u.getStart(),"p");if(r){l=new tinymce.dom.TreeWalker(r,r);while((n=l.next())){if(n.nodeType==3){s=n;break}}if(s){q=d(s.data);if(!q){return}k=u.getRng(true);m=k.startContainer;o=k.startOffset;if(s==m){o=Math.max(0,o-q.start.length)}if(tinymce.trim(s.data).length==q.start.length){return}if(q.format){t=f.formatter.get(q.format);if(t&&t[0].block){s.deleteData(0,q.start.length);f.formatter.apply(q.format,{},s);k.setStart(m,o);k.collapse(true);u.setRng(k)}}if(q.cmd){f.undoManager.transact(function(){s.deleteData(0,q.start.length);f.execCommand(q.cmd)})}}}}function c(){var k,l;l=e();if(l){k=f.dom.createRng();k.setStart(l,l.data.length);k.setEnd(l,l.data.length);f.selection.setRng(k)}i()}function g(){var n,m,l,k,o;n=e(true);if(n){o=f.dom;m=n.data.slice(-1);if(/[\u00a0 ]/.test(m)){n.deleteData(n.data.length-1,1);l=o.doc.createTextNode(m);if(n.nextSibling){o.insertAfter(l,n.nextSibling)}else{n.parentNode.appendChild(l)}k=o.createRng();k.setStart(l,1);k.setEnd(l,1);f.selection.setRng(k)}}}f.on("keydown",function(k){if(k.keyCode==13&&!tinymce.util.VK.modifierPressed(k)){c()}},true);f.on("keyup",function(k){if(k.keyCode==32&&!tinymce.util.VK.modifierPressed(k)){g()}});this.getPatterns=j;this.setPatterns=function(k){b=k;a=true}});