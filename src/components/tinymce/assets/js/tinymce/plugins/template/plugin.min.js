// plugin.js
tinymce.PluginManager.add("template",function(e){var g=tinymce.each;function f(i){return function(){var j=e.settings.templates;if(typeof j=="string"){tinymce.util.XHR.send({url:j,success:function(k){i(tinymce.util.JSON.parse(k))}})}else{i(j)}}}function a(l){var m,k=[],j;if(!l||l.length===0){e.windowManager.alert("No templates defined");return}tinymce.each(l,function(n){k.push({selected:!k.length,text:n.title,value:{url:n.url,content:n.content,description:n.description}})});function i(p){var o=p.control.value();function n(q){if(q.indexOf("<html>")==-1){var s="";tinymce.each(e.contentCSS,function(t){s+='<link type="text/css" rel="stylesheet" href="'+e.documentBaseURI.toAbsolute(t)+'">'});q=("<!DOCTYPE html><html><head>"+s+"</head><body>"+q+"</body></html>")}q=d(q,"template_preview_replace_values");var r=m.find("iframe")[0].getEl().contentWindow.document;r.open();r.write(q);r.close()}if(o.url){tinymce.util.XHR.send({url:o.url,success:function(q){j=q;n(j)}})}else{j=o.content;n(j)}m.find("#description")[0].text(p.control.value().description)}m=e.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:k,onselect:i}}]},{type:"label",name:"description",label:"Description",text:"\u00a0"},{type:"iframe",flex:1,border:1}],onsubmit:function(){c(false,j)},width:e.getParam("template_popup_width",600),height:e.getParam("template_popup_height",500)});m.find("listbox")[0].fire("select")}function b(j,m){var i="Sun Mon Tue Wed Thu Fri Sat Sun".split(" ");var o="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");var n="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");var l="January February March April May June July August September October November December".split(" ");function k(r,p){r=""+r;if(r.length<p){for(var q=0;q<(p-r.length);q++){r="0"+r}}return r}m=m||new Date();j=j.replace("%D","%m/%d/%Y");j=j.replace("%r","%I:%M:%S %p");j=j.replace("%Y",""+m.getFullYear());j=j.replace("%y",""+m.getYear());j=j.replace("%m",k(m.getMonth()+1,2));j=j.replace("%d",k(m.getDate(),2));j=j.replace("%H",""+k(m.getHours(),2));j=j.replace("%M",""+k(m.getMinutes(),2));j=j.replace("%S",""+k(m.getSeconds(),2));j=j.replace("%I",""+((m.getHours()+11)%12+1));j=j.replace("%p",""+(m.getHours()<12?"AM":"PM"));j=j.replace("%B",""+e.translate(l[m.getMonth()]));j=j.replace("%b",""+e.translate(n[m.getMonth()]));j=j.replace("%A",""+e.translate(o[m.getDay()]));j=j.replace("%a",""+e.translate(i[m.getDay()]));j=j.replace("%%","%");return j}function h(j){var k=e.dom,i=e.getParam("template_replace_values");g(k.select("*",j),function(l){g(i,function(n,m){if(k.hasClass(l,m)){if(typeof i[m]=="function"){i[m](l)}}})})}function d(i,j){g(e.getParam(j),function(m,l){if(typeof m!="function"){i=i.replace(new RegExp("\\{\\$"+l+"\\}","g"),m)}});return i}function c(m,j){var k,p,o=e.dom,l=e.selection.getContent();j=d(j,"template_replace_values");k=o.create("div",null,j);p=o.select(".mceTmpl",k);if(p&&p.length>0){k=o.create("div",null);k.appendChild(p[0].cloneNode(true))}function i(r,q){return new RegExp("\\b"+q+"\\b","g").test(r.className)}g(o.select("*",k),function(q){if(i(q,e.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))){q.innerHTML=b(e.getParam("template_cdate_format",e.getLang("template.cdate_format")))}if(i(q,e.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){q.innerHTML=b(e.getParam("template_mdate_format",e.getLang("template.mdate_format")))}if(i(q,e.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))){q.innerHTML=l}});h(k);e.execCommand("mceInsertContent",false,k.innerHTML);e.addVisual()}e.addCommand("mceInsertTemplate",c);e.addButton("template",{title:"Insert template",onclick:f(a)});e.addMenuItem("template",{text:"Insert template",onclick:f(a),context:"insert"});e.on("PreProcess",function(j){var i=e.dom;g(i.select("div",j.node),function(k){if(i.hasClass(k,"mceTmpl")){g(i.select("*",k),function(l){if(i.hasClass(l,e.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){l.innerHTML=b(e.getParam("template_mdate_format",e.getLang("template.mdate_format")))}});h(k)}})})});