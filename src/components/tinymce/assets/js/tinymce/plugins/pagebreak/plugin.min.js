// plugin.js
tinymce.PluginManager.add("pagebreak",function(c){var d="mce-pagebreak",a=c.getParam("pagebreak_separator","<!-- pagebreak -->");var e=new RegExp(a.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(f){return"\\"+f}),"gi");var b='<img src="'+tinymce.Env.transparentSrc+'" class="'+d+'" data-mce-resize="false" />';c.addCommand("mcePageBreak",function(){if(c.settings.pagebreak_split_block){c.insertContent("<p>"+b+"</p>")}else{c.insertContent(b)}});c.addButton("pagebreak",{title:"Page break",cmd:"mcePageBreak"});c.addMenuItem("pagebreak",{text:"Page break",icon:"pagebreak",cmd:"mcePageBreak",context:"insert"});c.on("ResolveName",function(f){if(f.target.nodeName=="IMG"&&c.dom.hasClass(f.target,d)){f.name="pagebreak"}});c.on("click",function(f){f=f.target;if(f.nodeName==="IMG"&&c.dom.hasClass(f,d)){c.selection.select(f)}});c.on("BeforeSetContent",function(f){f.content=f.content.replace(e,b)});c.on("PreInit",function(){c.serializer.addNodeFilter("img",function(g){var h=g.length,k,j;while(h--){k=g[h];j=k.attr("class");if(j&&j.indexOf("mce-pagebreak")!==-1){var f=k.parent;if(c.schema.getBlockElements()[f.name]&&c.settings.pagebreak_split_block){f.type=3;f.value=a;f.raw=true;k.remove();continue}k.type=3;k.value=a;k.raw=true}}})})});