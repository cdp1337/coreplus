(function(){namespace="scroll_";testCM("bars_hidden",function(h){for(var j=0;;j++){var l=h.getWrapperElement().getBoundingClientRect();var k=h.getScrollerElement().getBoundingClientRect();is(l.bottom<k.bottom-10);is(l.right<k.right-10);if(j==1){break}h.getWrapperElement().style.height="auto";h.refresh()}});function c(h){return byClassName(h.getWrapperElement(),"CodeMirror-hscrollbar")[0]}function g(h){return byClassName(h.getWrapperElement(),"CodeMirror-vscrollbar")[0]}function f(h,i){if(i){return c(h).getBoundingClientRect().top}else{return h.getWrapperElement().getBoundingClientRect().bottom-1}}function b(h,i){if(i){return g(h).getBoundingClientRect().left}else{return h.getWrapperElement().getBoundingClientRect().right-1}}function e(h,m){h.setSize("100px","100px");if(m){h.setValue(new Array(100).join("x"))}var k=f(h,m);for(var l=0;l<30;l++){h.replaceSelection("x\n");var j=h.cursorCoords(null,"window").bottom;is(j<=k)}is(j>=k-5)}testCM("movedown_fixed",function(h){e(h,false)});testCM("movedown_hscroll_fixed",function(h){e(h,true)});function a(h,m){h.getWrapperElement().style.height="auto";if(m){h.setValue(new Array(100).join("x"))}h.refresh();for(var l=0;l<30;l++){h.replaceSelection("x\n");var k=f(h,m);var j=h.cursorCoords(null,"window").bottom;is(j<=k);is(j>=k-5)}}testCM("movedown_resize",function(h){a(h,false)});testCM("movedown_hscroll_resize",function(h){a(h,true)});function d(j,m,h){j.setSize("100px","100px");if(m){j.setOption("lineWrapping",true)}if(h){j.setValue("\n"+new Array(100).join("x\n"));j.setCursor(Pos(0,0))}var l=b(j,h);for(var k=0;k<10;k++){j.replaceSelection("xxxxxxxxxx");var n=j.cursorCoords(null,"window").right;is(n<l)}if(!m){is(n>l-20)}}testCM("moveright",function(h){d(h,false,false)});testCM("moveright_wrap",function(h){d(h,true,false)});testCM("moveright_scroll",function(h){d(h,false,true)});testCM("moveright_scroll_wrap",function(h){d(h,true,true)});testCM("suddenly_wide",function(h){addDoc(h,100,100);h.replaceSelection(new Array(600).join("l ")+"\n");h.execCommand("goLineUp");h.execCommand("goLineEnd");is(c(h).scrollLeft>h.getScrollerElement().scrollLeft-1)});testCM("wrap_changes_height",function(h){var i=new Array(20).join("a ")+"\n";h.setValue(new Array(20).join(i));var j=h.getWrapperElement().getBoundingClientRect();h.setSize(h.cursorCoords(Pos(0),"window").right-j.left+2,h.cursorCoords(Pos(19,0),"window").bottom-j.top+2);h.setCursor(Pos(19,0));h.replaceSelection("\n");is(h.cursorCoords(null,"window").bottom<f(h,false))},{lineWrapping:true});testCM("height_auto_with_gutter_expect_no_scroll_after_line_delete",function(h){h.setSize(null,"auto");h.setValue("x\n");h.execCommand("goDocEnd");h.execCommand("delCharBefore");eq(h.getScrollInfo().top,0);h.scrollTo(null,10);is(h.getScrollInfo().top<5)},{lineNumbers:true})})();