(function(){function a(u,k,g){var p={},r=0,j=u.length,o=[];while(u){var i=u.match(/^(\w+)(\*?)(?:='([^\']*)'|<(~?)(\w+)(?:\/(\d+)-(\d+))?)\s*/);var h=i[1],q=i[2],t;if(i[3]){t=q?CodeMirror.Doc(i[3]):CodeMirror(k,f(g,{value:i[3]}))}else{var n=i[5];if(!p.hasOwnProperty(n)){p[n]=o.length;o.push(CodeMirror(k,g))}var s=o[p[n]].linkedDoc({sharedHist:!i[4],from:i[6]?Number(i[6]):null,to:i[7]?Number(i[7]):null});t=q?s:CodeMirror(k,f(g,{value:s}))}p[h]=o.length;o.push(t);u=u.slice(i[0].length)}return o}function f(i,g){if(!i){return}f.prototype=i;var h=new f();if(g){for(var j in g){if(g.hasOwnProperty(j)){h[j]=g[j]}}}return h}function d(k){var g=arguments.length,j=null;if(typeof arguments[g-1]=="string"){j=arguments[--g]}if(h==g){throw new Error("No editors provided to eqAll")}for(var h=1;h<g;++h){eq(arguments[h].getValue(),k,j)}}function c(h,g,k,j,i){if(!j){j={}}return test("doc_"+h,function(){var l=document.getElementById("testground");var n=a(g,l,j);var o=false;try{k.apply(null,n);o=true}finally{if((debug&&!o)||verbose){l.style.visibility="visible"}else{for(var m=0;m<n.length;++m){if(n[m] instanceof CodeMirror){l.removeChild(n[m].getWrapperElement())}}}}},i)}var e=/MSIE [1-7]\b/.test(navigator.userAgent);function b(h,g){d("x",h,g);h.setValue("hey");d("hey",h,g);g.setValue("wow");d("wow",h,g);h.replaceRange("u\nv\nw",Pos(0,3));g.replaceRange("i",Pos(0,4));g.replaceRange("j",Pos(2,1));d("wowui\nv\nwj",h,g)}c("basic","A='x' B<A",b);c("basicSeparate","A='x' B<~A",b);c("sharedHist","A='ab\ncd\nef' B<A",function(h,g){h.replaceRange("x",Pos(0));g.replaceRange("y",Pos(1));h.replaceRange("z",Pos(2));d("abx\ncdy\nefz",h,g);h.undo();h.undo();d("abx\ncd\nef",h,g);h.redo();d("abx\ncdy\nef",h,g);g.redo();d("abx\ncdy\nefz",h,g);h.undo();g.undo();h.undo();h.undo();d("ab\ncd\nef",h,g)},null,e);c("undoIntact","A='ab\ncd\nef' B<~A",function(h,g){h.replaceRange("x",Pos(0));g.replaceRange("y",Pos(1));h.replaceRange("z",Pos(2));h.replaceRange("q",Pos(0));d("abxq\ncdy\nefz",h,g);h.undo();h.undo();d("abx\ncdy\nef",h,g);g.undo();d("abx\ncd\nef",h,g);h.redo();d("abx\ncd\nefz",h,g);h.redo();d("abxq\ncd\nefz",h,g);h.undo();h.undo();h.undo();h.undo();d("ab\ncd\nef",h,g);g.redo();d("ab\ncdy\nef",h,g)});c("undoConflict","A='ab\ncd\nef' B<~A",function(h,g){h.replaceRange("x",Pos(0));h.replaceRange("z",Pos(2));g.replaceRange("y",Pos(0));h.undo();h.undo();d("abxy\ncd\nef",h,g);h.replaceRange("u",Pos(2));h.replaceRange("v",Pos(0));g.replaceRange("w",Pos(0));h.undo();h.undo();d("abxyvw\ncd\nefu",h,g)});c("doubleRebase","A='ab\ncd\nef\ng' B<~A C<B",function(h,g,i){i.replaceRange("u",Pos(3));h.replaceRange("",Pos(0,0),Pos(1,0));i.undo();d("cd\nef\ng",h,g,i)});c("undoUpdate","A='ab\ncd\nef' B<~A",function(h,g){h.replaceRange("x",Pos(2));g.replaceRange("u\nv\nw\n",Pos(0,0));h.undo();d("u\nv\nw\nab\ncd\nef",h,g);h.redo();d("u\nv\nw\nab\ncd\nefx",h,g);h.undo();d("u\nv\nw\nab\ncd\nef",h,g);g.undo();h.redo();d("ab\ncd\nefx",h,g);h.undo();d("ab\ncd\nef",h,g)});c("undoKeepRanges","A='abcdefg' B<A",function(i,h){var g=i.markText(Pos(0,1),Pos(0,3),{className:"foo"});h.replaceRange("x",Pos(0,0));eqPos(g.find().from,Pos(0,2));h.replaceRange("yzzy",Pos(0,1),Pos(0));eq(g.find(),null);h.undo();eqPos(g.find().from,Pos(0,2));h.undo();eqPos(g.find().from,Pos(0,1))});c("longChain","A='uv' B<A C<B D<C",function(h,g,j,i){h.replaceSelection("X");d("Xuv",h,g,j,i);i.replaceRange("Y",Pos(0));d("XuvY",h,g,j,i)});c("broadCast","B<A C<A D<A E<A",function(h,g,k,j,i){g.setValue("uu");d("uu",h,g,k,j,i);h.replaceRange("v",Pos(0,1));d("uvu",h,g,k,j,i)});c("islands","A='x\ny\nz' B<A C<~A D<C",function(h,g,j,i){h.replaceRange("u",Pos(0));i.replaceRange("v",Pos(2));g.undo();d("x\ny\nzv",h,g,j,i);j.undo();d("x\ny\nz",h,g,j,i);h.redo();d("xu\ny\nz",h,g,j,i);i.redo();d("xu\ny\nzv",h,g,j,i)});c("unlink","B<A C<A D<B",function(h,g,j,i){h.setValue("hi");g.unlinkDoc(h);i.setValue("aye");d("hi",h,j);d("aye",g,i);h.setValue("oo");d("oo",h,j);d("aye",g,i)});c("bareDoc","A*='foo' B*<A C<B",function(h,g,i){is(h instanceof CodeMirror.Doc);is(g instanceof CodeMirror.Doc);is(i instanceof CodeMirror);d("foo",h,g,i);h.replaceRange("hey",Pos(0,0),Pos(0));i.replaceRange("!",Pos(0));d("hey!",h,g,i);g.unlinkDoc(h);g.setValue("x");d("x",g,i);d("hey!",h)});c("swapDoc","A='a' B*='b' C<A",function(h,g,j){var i=h.swapDoc(g);i.setValue("x");d("x",j,i);d("b",h,g)});c("docKeepsScroll","A='x' B*='y'",function(h,g){addDoc(h,200,200);h.scrollIntoView(Pos(199,200));var j=h.swapDoc(g);h.swapDoc(j);var i=h.getScrollInfo();is(i.left>0,"not at left");is(i.top>0,"not at top")});c("copyDoc","A='u'",function(h){var i=h.getDoc().copy(true);h.setValue("foo");i.setValue("bar");var g=h.swapDoc(i);eq(h.getValue(),"bar");h.undo();eq(h.getValue(),"u");h.swapDoc(g);eq(h.getValue(),"foo");eq(g.historySize().undo,1);eq(g.copy(false).historySize().undo,0)});c("docKeepsMode","A='1+1'",function(i){var g=CodeMirror.Doc("hi","text/x-markdown");i.setOption("mode","text/javascript");var h=i.swapDoc(g);eq(i.getOption("mode"),"text/x-markdown");eq(i.getMode().name,"markdown");i.swapDoc(h);eq(i.getOption("mode"),"text/javascript");eq(i.getMode().name,"javascript")});c("subview","A='1\n2\n3\n4\n5' B<~A/1-3",function(h,g){eq(g.getValue(),"2\n3");eq(g.firstLine(),1);g.setCursor(Pos(4));eqPos(g.getCursor(),Pos(2,1));h.replaceRange("-1\n0\n",Pos(0,0));eq(g.firstLine(),3);eqPos(g.getCursor(),Pos(4,1));h.undo();eqPos(g.getCursor(),Pos(2,1));g.replaceRange("oyoy\n",Pos(2,0));eq(h.getValue(),"1\n2\noyoy\n3\n4\n5");g.undo();eq(h.getValue(),"1\n2\n3\n4\n5")});c("subviewEditOnBoundary","A='11\n22\n33\n44\n55' B<~A/1-4",function(h,g){h.replaceRange("x\nyy\nz",Pos(0,1),Pos(2,1));eq(g.firstLine(),2);eq(g.lineCount(),2);eq(g.getValue(),"z3\n44");h.replaceRange("q\nrr\ns",Pos(3,1),Pos(4,1));eq(g.firstLine(),2);eq(g.getValue(),"z3\n4q");eq(h.getValue(),"1x\nyy\nz3\n4q\nrr\ns5");h.execCommand("selectAll");h.replaceSelection("!");d("!",h,g)});c("sharedMarker","A='ab\ncd\nef\ngh' B<A C<~A/1-2",function(h,g,l){var k=g.markText(Pos(0,1),Pos(3,1),{className:"cm-searching",shared:true});var j=h.findMarksAt(Pos(0,2));eq(j.length,1);eq(j[0],k);eq(l.findMarksAt(Pos(1,1)).length,1);eqPos(k.find().from,Pos(0,1));eqPos(k.find().to,Pos(3,1));g.replaceRange("x\ny\n",Pos(0,0));eqPos(k.find().from,Pos(2,1));eqPos(k.find().to,Pos(5,1));var i=0;CodeMirror.on(k,"clear",function(){++i});g.operation(function(){k.clear()});eq(h.findMarksAt(Pos(3,1)).length,0);eq(g.findMarksAt(Pos(3,1)).length,0);eq(l.findMarksAt(Pos(3,1)).length,0);eq(k.find(),null);eq(i,1)});c("undoInSubview","A='line 0\nline 1\nline 2\nline 3\nline 4' B<A/1-4",function(h,g){g.replaceRange("x",Pos(2,0));h.undo();eq(h.getValue(),"line 0\nline 1\nline 2\nline 3\nline 4");eq(g.getValue(),"line 1\nline 2\nline 3")})})();