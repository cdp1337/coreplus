// Helper to test CodeMirror highlighting modes. It pretty prints output of the
(function(){function i(l,m,j){for(;;){var k=l.indexOf(j,m);if(k==-1){return null}if(l.charAt(k+1)!=j){return k}m=k+2}}var b=/[\w&-_]+/g;function h(o){var r=[],t="";for(var n=0;n<o.length;++n){if(n){t+="\n"}var q=o[n],s=0;while(s<q.length){var j=null,u;if(q.charAt(s)=="["&&q.charAt(s+1)!="["){b.lastIndex=s+1;var k=b.exec(q);j=k[0].replace(/&/g," ");var p=s+j.length+2;var l=i(q,p,"]");if(l==null){throw new Error("Unterminated token at "+s+" in '"+q+"'"+j)}u=q.slice(p,l);s=l+1}else{var l=i(q,s,"[");if(l==null){l=q.length}u=q.slice(s,l);s=l}u=u.replace(/\[\[|\]\]/g,function(m){return m.charAt(0)});r.push({style:j,text:u});t+=u}}return{tokens:r,plain:t}}test.mode=function(j,m,l,n){var k=h(l);return test((n||m.name)+"_"+j,function(){return a(k.plain,k.tokens,m)})};function g(j){return j.replace("&","&amp;").replace("<","&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function a(p,n,m){var q=[];for(var l=0;l<n.length;++l){var k=n[l].style;if(k&&k.indexOf(" ")){k=k.split(" ").sort().join(" ")}q.push({style:k,text:n[l].text})}var j=c(p,m);var r="";var o=d(q,j);if(o!=null){r+='<div class="mt-test mt-fail">';r+="<pre>"+g(p)+"</pre>";r+='<div class="cm-s-default">';r+="expected:";r+=f(q,o);r+="observed: [<a onclick=\"this.parentElement.className+=' mt-state-unhide'\">display states</a>]";r+=f(j,o);r+="</div>";r+="</div>"}if(j.indentFailures){for(var l=0;l<j.indentFailures.length;l++){r+="<div class='mt-test mt-fail'>"+g(j.indentFailures[l])+"</div>"}}if(r){throw new Failure(r)}}function e(k){function j(n,o){if(typeof o=="function"){var l=o.toString().match(/function\s*[^\s(]*/);return l?l[0]:"function"}return o}if(window.JSON&&JSON.stringify){return JSON.stringify(k,j,2)}return"[unsupported]"}function c(r,q){var k=q.startState();var x=r.replace(/\r\n/g,"\n").split("\n");var w=[],u=0;for(var p=0;p<x.length;++p){var y=x[p],s=true;if(q.indent){var t=y.match(/^\s*/)[0];var n=q.indent(k,y.slice(t.length));if(n!=CodeMirror.Pass&&n!=t.length){(w.indentFailures||(w.indentFailures=[])).push("Indentation of line "+(p+1)+" is "+n+" (expected "+t.length+")")}}var v=new CodeMirror.StringStream(y);if(y==""&&q.blankLine){q.blankLine(k)}while(!v.eol()){for(var o=0;o<10&&v.start>=v.pos;o++){var l=q.token(v,k)}if(o==10){throw new Failure("Failed to advance the stream."+v.string+" "+v.pos)}var m=v.current();if(l&&l.indexOf(" ")>-1){l=l.split(" ").sort().join(" ")}v.start=v.pos;if(u&&w[u-1].style==l&&!s){w[u-1].text+=m}else{if(m){w[u++]={style:l,text:m,state:e(k)}}}if(v.pos>5000){w[u++]={style:null,text:this.text.slice(v.pos)};break}s=false}}return w}function d(m,l){var j=Math.min(m.length,l.length);for(var k=0;k<j;++k){if(m[k].style!=l[k].style||m[k].text!=l[k].text){return k}}if(m.length>j||l.length>j){return j}}function f(j,n){var m='<table class="mt-output">';m+="<tr>";for(var k=0;k<j.length;++k){var l=j[k].style,o=j[k].text;m+='<td class="mt-token"'+(k==n*2?" style='background: pink'":"")+'><span class="cm-'+g(String(l))+'">'+g(o.replace(/ /g,"\xb7"))+"</span></td>"}m+="</tr><tr>";for(var k=0;k<j.length;++k){m+='<td class="mt-style"><span>'+(j[k].style||null)+"</span></td>"}if(j[0].state){m+='</tr><tr class="mt-state-row" title="State AFTER each token">';for(var k=0;k<j.length;++k){m+='<td class="mt-state"><pre>'+g(j[k].state)+"</pre></td>"}}m+="</tr></table>";return m}})();